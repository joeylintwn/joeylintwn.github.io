function MeasureInit(){var t,u,i="0",n,r=1;require(["esri/Color","esri/symbols/TextSymbol","esri/symbols/Font","esri/toolbars/draw","esri/graphic","esri/tasks/GeometryService","esri/tasks/AreasAndLengthsParameters","esri/tasks/LengthsParameters","dojo/_base/lang","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/domReady!"],function(f,e,o,s,h,c,l,a,v,y,p,w){function d(e){var o,s;t=e.geometry;n.deactivate();map.showZoomSlider();switch(t.type){case"polyline":o=new p("solid",new f("blue"),2);i=="0"&&g(t);break;case"point":o=new y(y.STYLE_CIRCLE,20,new p(p.STYLE_SOLID,new f([0,0,0]),1),new f([255,0,0,1]));case"polygon":if(u!="")switch(u){case"Polygon":o=new w;i=="0"&&tt(t);break;case"Circle":o=new w;break;case"Rectangle":o=new w}break;default:o=new w}if(n.onAddToMap!=null)n.onAddToMap(e);s=new h(t,o);s.id="Measure"+r.toString();map.graphics.add(s)}function g(n){var t=new a;t.polylines=[n];t.lengthUnit=c.UNIT_KILOMETER;t.geodesic=!0;b.lengths(t)}function nt(n){var l=n.result,i=l.lengths[0],s="",c,u;s=i<1?"距離 = "+k(i*1e3,0)+"公尺":"距離 = "+k(i,3)+"公里";c=new e(s).setColor(new f([128,0,0])).setAlign(o.ALIGN_START).setFont(new o("14pt").setWeight(o.WEIGHT_BOLD)).setOffset(0,5);u=new h(t.getPoint(0,0),c);u.id="MeasureTxt"+r.toString();map.graphics.add(u);r++}function tt(n){var t=new l;t.lengthUnit=c.UNIT_KILOMETER;t.areaUnit=c.UNIT_SQUARE_KILOMETERS;t.calculationType="geodesic";b.simplify([n],function(n){t.polygons=n;b.areasAndLengths(t)})}function it(n){var l=n.result,i=l.areas[0],s="",c,u;s=i<1?"面積 = "+k(i*1e6,0)+"平方公尺":"面積 = "+k(i,3)+"平方公里";c=new e(s).setColor(new f([128,0,0])).setAlign(o.ALIGN_START).setFont(new o("14pt").setWeight(o.WEIGHT_BOLD));u=new h(t.getCentroid(),c);u.id="MeasureTxt"+r.toString();map.graphics.add(u);r++}function k(n,t){typeof n=="string"&&(n=parseFloat(n));for(var n=n.toFixed(t)+"",r=n.split("."),i=r[0],f=r.length>1?"."+r[1]:"",u=/(\d+)(\d{3})/;u.test(i);)i=i.replace(u,"$1,$2");return i+f}n=new s(map);n.on("draw-end",d);var b=new c("http://118.163.96.187/arcgis/rest/services/Utilities/Geometry/GeometryServer");b.on("areas-and-lengths-complete",it);b.on("lengths-complete",nt);this.stopMeasrue=function(){typeof n!="undefined"&&n.deactivate()};this.myActivateTool=function(t){stopMeasrue();var i=t.toUpperCase().replace(/ /g,"_");n.setLineSymbol(new p("solid",new f("blue"),2));n.activate(s[i],{showTooltips:!1});map.hideZoomSlider()};this.startMeasure=function(){n!=undefined&&(n.finishDrawing(),n.deactivate())}});this.activateTool=function(t){n.onAddToMap=null;u=t;myActivateTool(t)};this.SetDrawMethod=function(t,r){this.Method=t;t=="Polygon"||t=="MeasureArea"?(this.activateTool("Polygon"),i="0"):t=="Polyline"?(this.activateTool("Polyline"),i="1"):t=="MeasureDistance"?(this.activateTool("Polyline"),i="0"):t=="Circle"?this.activateTool("Circle"):t=="Rect"?this.activateTool("Rectangle"):t=="Point"||t=="Text"?this.activateTool("Point"):t=="AreaPolygon"&&(this.activateTool("Polygon"),i="1");n.onAddToMap=r}}