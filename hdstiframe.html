<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>下載PDF</title>
    <script src="scripts/jquery-3.5.1.min.js"></script>
</head>

<body>
    <button type="button" id="ccc">我是按鈕</button>
    <input type="text" value="10000" id="ttt">
    <br>
    <textarea id="sss" style="width:500px;height:500px"></textarea>
    <textarea id="ggg" style="width:500px;height:500px"></textarea>


    <script type="text/javascript">
        var urlar = [


        ];
        /*
        
            ['大埔排水_1091201_正常_雨_0K800', 'https://wra.e-land.gov.tw/HDST/WaterAdmin/Check/CheckA?checkID=23348'],
['十六份排水_1091202_正常_雨_5K100', 'https://wra.e-land.gov.tw/HDST/WaterAdmin/Check/CheckA?checkID=23427']

        */

        document.getElementById('ccc').addEventListener("click", function () {
            loadcnt = 0;
            console.log(document.getElementById('sss').value);
            urlar = eval("["+document.getElementById('sss').value+"]");
            console.log(urlar);
            if (urlar.length > 0) {
                if (loadcnt < urlar.length) {
                    callnext();
                }
            }
        });

        var loadcnt = 0;
        

        
   
        

        function callnext() {
            document.getElementById('ggg').value += urlar[loadcnt][0] + "&#10;";
            var vw = window.open(urlar[loadcnt][1], "_blank", ""); //第二种写法，不用再每个页面添加window.focus(); 只需改为这种写法
            //vw.document.title = loadcnt;
            console.log('loadstart' + Date.now().toString());
            vw.addEventListener('load', function () {
                
                console.log('loadcomplete');
                vw.btnExportODF_onclick('pdf');
                loadcnt += 1;
                if (loadcnt < urlar.length+1) {
                    console.log('下一筆: ' + loadcnt + "  " + +Date.now().toString());
                    setTimeout(function () {
                        vw.close();
                        console.log('等3秒開始: ' + loadcnt+"  "+Date.now().toString());
                        
                        callnext();
                    }, parseInt(document.getElementById('ttt').value))
                    
                }
            }, true);
        }

        /*
         $(document).ready(function (e) {
           
             

             /*
            var iframe = document.getElementById("box");
            if (iframe.attachEvent) {
                iframe.attachEvent("onload", function () {
                    alert('onload')
                    //iframe載入完成後你需要進行的操作
                });
            } else {
                iframe.onload = function () {
                    //iframe載入完成後你需要進行的操作
                    console.log('讀取到第' + loadcnt + '筆');
                    var $iframe = $(this),
			        $contents = $iframe.contents();
                    $iframe.get(0).contentWindow.btnExportODF_onclick('pdf');
                   
                    var data = $iframe.contents().find("#div_form").html();
                    console.log(data);
                    var blob = new Blob([data], { "type": "text/html" });
                    console.log(blob);

                    //對於Blob物件，我們可以創建出一個URL來訪問它。使用URL物件的createObjectURL方法。
                    var a = document.createElement('a');
                    a.download = urlar[loadcnt][0]+'.html';
                    a.href = window.URL.createObjectURL(blob);
                    a.click()

                    loadcnt += 1;
                    if (loadcnt == urlar.length) {
                        alert('done');
                        return;
                    } else {
                        console.log('開始下載pdf，3秒後開啟下一筆')
                        setTimeout(function () {
                            $('#box').attr('src', urlar[loadcnt][1]);
                        }, 3000);
                    }
                };
            }
        });
        
        $('#box').attr('src', urlar[loadcnt][1]);
        */
        //if...else...是一種相容ie的寫法

      
    </script>
    
</body>
</html>
